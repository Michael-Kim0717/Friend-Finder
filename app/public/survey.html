<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title> Friend Finder Survey </title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <!-- Bootstrap and JQuery -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://code.jquery.com/jquery.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

        <!-- Files to be used at a later time -->
        <!-- <script src="main.js"></script> -->
    </head>
    <body>
        <h1> Friend Finder </h1>
        
        <div class="container" id="introContainer">
            <h3> You are one step closer to finding a new friend! </h3>
            <div class="text-center">
                <button class="btn btn-light fa" id="homeButton"> <a href="./home"> <i class="fa fa-home fa-2x"></i> </a> </button>
            </div>
        </div>

        <div class="container" id="surveyContainer">
            <h4> Pick the answer that best fits you! </h4>
            <form>
                <h5 id="nameText"> Name : </h5>
                <h5 id="imageText"> Link to Image : </h5>
                <br>
                <input type="text" id="nameField" class="textField" required>
                <input type="text" id="imageLink" class="textField" required>
                <br>

                <h5> Question 1 : You don't let other people influence your actions. </h5>
                <div class="twenty">
                    <input type="radio" class="radio q1c1" name="question1"/> 1 : Highly Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q1c2" name="question1"/> 2 : Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q1c3" name="question1"/> 3 : Neutral
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q1c4" name="question1"/> 4 : Agree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q1c5" name="question1"/> 5 : Highly Agree
                </div>

                <h5> Question 2 : You are usually highly motivated and energetic. </h5>
                <div class="twenty">
                    <input type="radio" class="radio q2c1" name="question2"/> 1 : Highly Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q2c2" name="question2"/> 2 : Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q2c3" name="question2"/> 3 : Neutral
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q2c4" name="question2"/> 4 : Agree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q2c5" name="question2"/> 5 : Highly Agree
                </div>
                
                <h5> Question 3 : Winning a debate to you matters less to you than making sure no one gets upset. </h5>
                <div class="twenty">
                    <input type="radio" class="radio q3c1" name="question3"/> 1 : Highly Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q3c2" name="question3"/> 2 : Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q3c3" name="question3"/> 3 : Neutral
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q3c4" name="question3"/> 4 : Agree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q3c5" name="question3"/> 5 : Highly Agree
                </div>
                
                <h5> Question 4 : Your home and work environments are quite tidy. </h5>
                <div class="twenty">
                    <input type="radio" class="radio q4c1" name="question4"/> 1 : Highly Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q4c2" name="question4"/> 2 : Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q4c3" name="question4"/> 3 : Neutral
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q4c4" name="question4"/> 4 : Agree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q4c5" name="question4"/> 5 : Highly Agree
                </div>
                
                <h5> Question 5 : If you had a business, you would find it very difficult to fire loyal but underperforming employees. </h5>
                <div class="twenty">
                    <input type="radio" class="radio q5c1" name="question5"/> 1 : Highly Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q5c2" name="question5"/> 2 : Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q5c3" name="question5"/> 3 : Neutral
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q5c4" name="question5"/> 4 : Agree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q5c5" name="question5"/> 5 : Highly Agree
                </div>
                
                <h5> Question 6 : If your friend is sad about something, you are more likely to offer emotional support than suggest ways to deal with the problem. </h5>
                <div class="twenty">
                    <input type="radio" class="radio q6c1" name="question6"/> 1 : Highly Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q6c2" name="question6"/> 2 : Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q6c3" name="question6"/> 3 : Neutral
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q6c4" name="question6"/> 4 : Agree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q6c5" name="question6"/> 5 : Highly Agree
                </div>
                
                <h5> Question 7 : An interesting book or video game is often better than a social event. </h5>
                <div class="twenty">
                    <input type="radio" class="radio q7c1" name="question7"/> 1 : Highly Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q7c2" name="question7"/> 2 : Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q7c3" name="question7"/> 3 : Neutral
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q7c4" name="question7"/> 4 : Agree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q7c5" name="question7"/> 5 : Highly Agree
                </div>
                
                <h5> Question 8 : As a parent, you'd rather see your child grow up kind than smart. </h5>
                <div class="twenty">
                    <input type="radio" class="radio q8c1" name="question8"/> 1 : Highly Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q8c2" name="question8"/> 2 : Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q8c3" name="question8"/> 3 : Neutral
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q8c4" name="question8"/> 4 : Agree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q8c5" name="question8"/> 5 : Highly Agree
                </div>
                
                <h5> Question 9 : You are more of a natural improviser than a careful planner. </h5>
                <div class="twenty">
                    <input type="radio" class="radio q9c1" name="question9"/> 1 : Highly Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q9c2" name="question9"/> 2 : Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q9c3" name="question9"/> 3 : Neutral
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q9c4" name="question9"/> 4 : Agree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q9c5" name="question9"/> 5 : Highly Agree
                </div>
                
                <h5> Question 10 : Your emotions control you more than you control them. </h5>
                <div class="twenty">
                    <input type="radio" class="radio q10c1" name="question10"/> 1 : Highly Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q10c2" name="question10"/> 2 : Disagree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q10c3" name="question10"/> 3 : Neutral
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q10c4" name="question10"/> 4 : Agree
                </div>
                <div class="twenty">
                    <input type="radio" class="radio q10c5" name="question10"/> 5 : Highly Agree
                </div>
                    
                <br>
                
                <div class="text-center">
                    <button type="button" id="submitSurvey" class="btn btn-success" data-toggle="modal">
                        Submit Survey
                    </button>
                </div>
            </form>
        </div>

        <div class="modal fade" id="friendModal" tabindex="-1" role="dialog" aria-labelledby="matchLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="matchLabel"> Match : </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <img id="matchImage"/>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </body>

    <script type="text/javascript">
        $(document).ready(function(){
            var arrayOfQuestions = ["question1", "question2", "question3", "question4", "question5", "question6", "question7", "question8", "question9", "question10"];
            
            $("#submitSurvey").on("click", function(event){
                event.preventDefault();
                
                // function to check if all fields are checked off
                if (checkAllQuestions(arrayOfQuestions)){
                    console.log("All Checked.");
                
                    // function to return an array filled with values
                    var surveyValues = returnArray(arrayOfQuestions);
                    console.log(surveyValues);

                    // function to find most matching friend
                    var friendMatch = 0;
                    $.ajax({ url: window.location.origin + "/api/friends", method: "GET" })
                    .then(function(friendsData) {
                        var minimumDifference = 200000, totalDifference = 0;

                        for (var i = 0; i < friendsData.length; i++) {
                            for (var j = 0; j < friendsData[i].scores.length; j++){
                                totalDifference += Math.abs(surveyValues[j] - friendsData[i].scores[j]);
                            }
                            if (totalDifference < minimumDifference) {
                                minimumDifference = totalDifference;
                                friendMatch = friendsData[i];
                            }
                            console.log(totalDifference);
                            totalDifference = 0;
                        }
                        console.log(friendMatch);
                    }).then(function(){
                        $(".modal-title").append(friendMatch.name);
                        $("#matchImage").attr("src", friendMatch.photo);
                        $("#friendModal").modal();

                        // post into API friends
                        var newFriend = {
                            name: $("#nameField").val().trim(),
                            photo: $("#imageLink").val().trim(),
                            scores: surveyValues
                        };
                        $.post("/api/friends", newFriend, function(data) {
                            if (data) {
                            }
                        });
                    });
                }
            });
        });

        function checkAllQuestions (arrayOfQuestions) {
            for (var i = 0; i < arrayOfQuestions.length; i++){
                if (!$("input[name=" + arrayOfQuestions[i] + "]:checked").val()) {
                    console.log(arrayOfQuestions[i] + " is not checked.");
                    return false;
                }
            }
            return true;
        }

        function returnArray (arrayOfQuestions){
            var surveyValues = [];

            for (var i = 0; i < arrayOfQuestions.length; i ++){
                if ($("input[name=" + arrayOfQuestions[i] + "]:checked")){
                    var className = $("input[name=" + arrayOfQuestions[i] + "]:checked").attr("class");
                    surveyValues.push(className.charAt(className.length-1));
                }
            }

            return surveyValues;
        } 
    </script>

    <style>
        /* General */

        /* Header */
        h1 {
            background-color: whitesmoke;
            border-bottom: 1px solid black;
            padding: 30px;
            letter-spacing: .1em;
            text-align: center;
            text-shadow: 0 0 2px black;
        }

        /* Intro Container */
        #homeButton {
            margin: 20px 0px 0px 0px;
        }

        #introContainer {
            background-color: #DCDCDC;
            border: 1px solid black;
            border-radius: 5px;
            margin: 30px auto;
            padding: 50px 30px 50px 30px;
            width: 40%;
        }

        h3 {
            color: black;
            font-size: 1.1em;
            text-align: center;
        }

        /* Survey Container */
        #surveyContainer {
            background-color: #DCDCDC;
            border: 1px solid black;
            border-radius: 5px;
            margin: 10px auto;
            padding: 50px 30px 50px 30px;
            width: 80%;
        }

        #nameText {
            display: inline-block;
            width: 49%;
        }

        #imageText {
            display: inline;
        }

        .textField {
            margin-bottom: 20px;
            width: 49%;
        }

        .radio {
            margin-bottom: 25px;
        }

        .twenty {
            display: inline-block;
            width: 19%;
        }
        
        h4 {
            color: black;
            font-size: 1.5em;
            margin-bottom: 40px;
            text-align: center;
        }

        h5 {
            font-size: 1.25em;
            padding: 10px;
        }

        #submitSurvey {
            margin-top: 50px;
        }
    </style>
</html>