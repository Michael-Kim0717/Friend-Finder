<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title> Friend Finder Survey </title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <!-- Bootstrap and JQuery -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://code.jquery.com/jquery.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

        <!-- Files to be used at a later time -->
        <!-- <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
        <script src="main.js"></script> -->
    </head>
    <body>
        <h1> Friend Finder </h1>
        <h3> You are one step closer to finding a new friend! </h3>
        <button> <a href="./home"> Home </a> </button>

        <h4> Pick the answer that best fits you! </h4>
        <form>
            <h3> Name </h3>
            <input type="text" id="nameField" required>
            <br>
            <h3> Link to Image </h3>
            <input type="text" id="imageLink" required>
            <br> 

            <h4> Question 1 </h4>
            <input type="radio" class="q1c1" name="question1"/> 1 : Highly Disagree
            <input type="radio" class="q1c2" name="question1"/> 2 : Disagree
            <input type="radio" class="q1c3" name="question1"/> 3 : Neutral
            <input type="radio" class="q1c4" name="question1"/> 4 : Agree
            <input type="radio" class="q1c5" name="question1"/> 5 : Highly Agree

            <h4> Question 2 </h4>
            <input type="radio" class="q2c1" name="question2"/> 1 : Highly Disagree
            <input type="radio" class="q2c2" name="question2"/> 2 : Disagree
            <input type="radio" class="q2c3" name="question2"/> 3 : Neutral
            <input type="radio" class="q2c4" name="question2"/> 4 : Agree
            <input type="radio" class="q2c5" name="question2"/> 5 : Highly Agree
            
            <h4> Question 3 </h4>
            <input type="radio" class="q3c1" name="question3"/> 1 : Highly Disagree
            <input type="radio" class="q3c2" name="question3"/> 2 : Disagree
            <input type="radio" class="q3c3" name="question3"/> 3 : Neutral
            <input type="radio" class="q3c4" name="question3"/> 4 : Agree
            <input type="radio" class="q3c5" name="question3"/> 5 : Highly Agree
            
            <h4> Question 4 </h4>
            <input type="radio" class="q4c1" name="question4"/> 1 : Highly Disagree
            <input type="radio" class="q4c2" name="question4"/> 2 : Disagree
            <input type="radio" class="q4c3" name="question4"/> 3 : Neutral
            <input type="radio" class="q4c4" name="question4"/> 4 : Agree
            <input type="radio" class="q4c5" name="question4"/> 5 : Highly Agree
            
            <h4> Question 5 </h4>
            <input type="radio" class="q5c1" name="question5"/> 1 : Highly Disagree
            <input type="radio" class="q5c2" name="question5"/> 2 : Disagree
            <input type="radio" class="q5c3" name="question5"/> 3 : Neutral
            <input type="radio" class="q5c4" name="question5"/> 4 : Agree
            <input type="radio" class="q5c5" name="question5"/> 5 : Highly Agree
            
            <h4> Question 6 </h4>
            <input type="radio" class="q6c1" name="question6"/> 1 : Highly Disagree
            <input type="radio" class="q6c2" name="question6"/> 2 : Disagree
            <input type="radio" class="q6c3" name="question6"/> 3 : Neutral
            <input type="radio" class="q6c4" name="question6"/> 4 : Agree
            <input type="radio" class="q6c5" name="question6"/> 5 : Highly Agree
            
            <h4> Question 7 </h4>
            <input type="radio" class="q7c1" name="question7"/> 1 : Highly Disagree
            <input type="radio" class="q7c2" name="question7"/> 2 : Disagree
            <input type="radio" class="q7c3" name="question7"/> 3 : Neutral
            <input type="radio" class="q7c4" name="question7"/> 4 : Agree
            <input type="radio" class="q7c5" name="question7"/> 5 : Highly Agree
            
            <h4> Question 8 </h4>
            <input type="radio" class="q8c1" name="question8"/> 1 : Highly Disagree
            <input type="radio" class="q8c2" name="question8"/> 2 : Disagree
            <input type="radio" class="q8c3" name="question8"/> 3 : Neutral
            <input type="radio" class="q8c4" name="question8"/> 4 : Agree
            <input type="radio" class="q8c5" name="question8"/> 5 : Highly Agree
            
            <h4> Question 9 </h4>
            <input type="radio" class="q9c1" name="question9"/> 1 : Highly Disagree
            <input type="radio" class="q9c2" name="question9"/> 2 : Disagree
            <input type="radio" class="q9c3" name="question9"/> 3 : Neutral
            <input type="radio" class="q9c4" name="question9"/> 4 : Agree
            <input type="radio" class="q9c5" name="question9"/> 5 : Highly Agree
            
            <h4> Question 10 </h4>
            <input type="radio" class="q10c1" name="question10"/> 1 : Highly Disagree
            <input type="radio" class="q10c2" name="question10"/> 2 : Disagree
            <input type="radio" class="q10c3" name="question10"/> 3 : Neutral
            <input type="radio" class="q10c4" name="question10"/> 4 : Agree
            <input type="radio" class="q10c5" name="question10"/> 5 : Highly Agree

            <br>
            <button type="submit" id="submitSurvey" data-toggle="modal" data-target="friendModal"> Submit Survey </button>
  
            <div class="modal fade" id="friendModal" role="dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title"> Match : </h4>
                        <button type="button" class="close" data-dismiss="modal"> &times; </button>
                    </div>
                    <div class="modal-body">
                        <img id="matchImage" height="300px" width="200px"/>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"> Close </button>
                    </div>
                </div>
            </div>

        </form>
    </body>

    <script type="text/javascript">
        $(document).ready(function(){
            var arrayOfQuestions = ["question1", "question2", "question3", "question4", "question5", "question6", "question7", "question8", "question9", "question10"];
            
            $("#submitSurvey").on("click", function(event){
                event.preventDefault();
                
                // function to check if all fields are checked off
                /* if (checkAllQuestions(arrayOfQuestions)){ */
                    console.log("All Checked.");
                
                    // function to return an array filled with values
                    var surveyValues = returnArray(arrayOfQuestions);
                    console.log(surveyValues);

                    // function to find most matching friend                    
                    var match = compareToFriends(surveyValues);

                    // show modal
                    $(".modal-title").append(match.name);
                    $("#matchImage").attr("src", match.photo);

                   /*  // post into API friends
                    var newFriend = {
                        name: $("#nameField").val().trim(),
                        photo: $("#imageLink").val().trim(),
                        scores: surveyValues
                    };
                    $.post("/api/friends", newFriend, function(data) {
                        if (data) {
                        }
                    }); */
                /* } */
            });
        });

        function checkAllQuestions (arrayOfQuestions) {
            for (var i = 0; i < arrayOfQuestions.length; i++){
                if (!$("input[name=" + arrayOfQuestions[i] + "]:checked").val()) {
                    console.log(arrayOfQuestions[i] + " is not checked.");
                    return false;
                }
            }
            return true;
        }

        function returnArray (arrayOfQuestions){
            var surveyValues = [];

            for (var i = 0; i < arrayOfQuestions.length; i ++){
                if ($("input[name=" + arrayOfQuestions[i] + "]:checked")){
                    var className = $("input[name=" + arrayOfQuestions[i] + "]:checked").attr("class");
                    surveyValues.push(className.charAt(className.length-1));
                }
            }

            return surveyValues;
        } 

        function compareToFriends (surveyValues) {
            $.ajax({ url: window.location.origin + "/api/friends", method: "GET" })
            .then(function(friendsData) {
                var minimumDifference = 200000, totalDifference = 0, friendMatch = 0;

                for (var i = 0; i < friendsData.length; i++) {
                    for (var j = 0; j < friendsData[i].scores.length; j++){
                        totalDifference += Math.abs(surveyValues[j] - friendsData[i].scores[j]);
                    }
                    if (totalDifference < minimumDifference) {
                        minimumDifference = totalDifference;
                        friendMatch = friendsData[i];
                    }
                    console.log(totalDifference);
                    totalDifference = 0;
                }
                console.log(friendMatch);
                return friendMatch;
            });
        }
    </script>
</html>